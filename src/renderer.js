import { nanoid } from 'nanoid';
import Orders from './js/orders.js'
import './index.css';

import './style.css';

let orders

function orderListDom (ordersList) {
    let entriesList = document.querySelector('.entries__list');
    entriesList.innerHTML = "";
    let ul = document.createElement('ul');
    console.log(ordersList)
    entriesList.append(ul)
    for (let item of ordersList.data) {
        let li = document.createElement('li');
        li.setAttribute('data-id', item.id);
        li.innerHTML = item.id + " " + item.name;
        li.addEventListener('click', () => {
            createModal();
            //orders.edit(item.id)
        })
        let span = document.createElement('span')
        span.innerHTML = "—É–¥–∞–ª–∏—Ç—å";
        span.addEventListener('click', async () => {
            await orders.delete(item.id);
            await orders.save(orders);
            await orders.getOrders();
            await orderListDom(orders);
        })
        ul.append(li);
        ul.append(span);
    }
}

window.addEventListener('DOMContentLoaded', () => {
    
    window.storage.entries((e, data) => {
        orders = new Orders(data);
        orderListDom(orders)
    })

    let btn = document.querySelector('.entries__btnAdd');
    
    btn.addEventListener('click', async () => {
        let entry = {
            id: nanoid(), //=> "V1StGXR8_Z5jdHi6B-myT"
            name: "–í—ã–ø–∏—Å–∫–∞"
        }
        await orders.add()
        // entries.push(entry);
        await orders.save(orders)
        await orders.getOrders();
        console.log("—Å–æ–±—ã—Ç–∏–µ")
        await orderListDom(orders);
    })


   
    
})

console.log('üëã This message is being logged by "renderer.js", included via webpack');






function createModal () {
    //let modal = document.querySelector('.modal');
    
    modal.innerHTML = `<form action="" id="formOrder">

    </form>
    <section class="container header">
        <header>
            –í—ã–ø–∏—Å–∫–∞
        </header>
        <h1>–í—ã–ø–∏—Å–∫–∞ –∏–∑ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–∞–≤–æ–≤–æ–≥–æ –∞–∫—Ç–∞ 
            –æ –±—é–¥–∂–µ—Ç–µ —Å—É–±—ä–µ–∫—Ç–∞ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏ 
            (–º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∞–≤–æ–≤–æ–≥–æ –∞–∫—Ç–∞ –æ –±—é–¥–∂–µ—Ç–µ), 
            –±—é–¥–∂–µ—Ç–Ω–æ–π —Ä–æ—Å–ø–∏—Å–∏ —Å—É–±—ä–µ–∫—Ç–∞ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏ 
            (–º–µ—Å—Ç–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞)
            –ö–∞–º—ã—à–ª–æ–≤—Å–∫–∏–π –≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–∫—Ä—É–≥
            –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—É–±—ä–µ–∫—Ç–∞ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏
            (–º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, –≤ —Å–æ—Å—Ç–∞–≤–µ —Å—É–±—ä–µ–∫—Ç–∞ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏)
        </h1>
    </section>

    <section class="container requisites" >
        <div><label for="date">–î–∞—Ç–∞ –≤—ã–ø–∏—Å–∫–∏: </label>
            <input type="date" id="date" name="date"/></div>
        <h2>–†–µ–∫–≤–∏–∑–∏—Ç—ã –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–∞–≤–æ–≤–æ–≥–æ –∞–∫—Ç–∞ –æ –±—é–¥–∂–µ—Ç–µ </h2>
        <table class="table">
            <thead>
                <tr>
                    <th>–ù–æ–º–µ—Ä</th>
                    <th>–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è</th>
                    <th>–¢–∏–ø –∞–∫—Ç–∞ (–∑–∞–∫–æ–Ω, —Ä–µ—à–µ–Ω–∏–µ)</th>
                    <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∞</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div>180</div>
                        <input form="formOrder" type="text" style="display:none" name="requisites-number" value="">
                    </td>
                    <td>
                        <div>08.12.2022</div>
                        <input form="formOrder" type="text" style="display:none" name="requisites-date" value="">
                    </td>
                    <td>
                        <div>—Ä–µ—à–µ–Ω–∏–µ</div>
                        <input form="formOrder" type="text" style="display:none" name="requisites-type" value="">
                    </td>
                    <td>
                        <div>–†–µ—à–µ–Ω–∏–µ –î—É–º—ã   –ö–∞–º—ã—à–ª–æ–≤—Å–∫–æ–≥–æ –≥–æ—Ä–æ–¥—Å–∫–æ–≥–æ –æ–∫—Ä—É–≥–∞  ¬´–û –±—é–¥–∂–µ—Ç–µ –ö–∞–º—ã—à–ª–æ–≤—Å–∫–æ–≥–æ –≥–æ—Ä–æ–¥—Å–∫–æ–≥–æ –æ–∫—Ä—É–≥–∞ –Ω–∞ 2023 –≥–æ–¥ –∏ –ø–ª–∞–Ω–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥ 2024 –∏ 2025 –≥–æ–¥–æ–≤¬ª</div>
                        <input form="formOrder" type="text" style="display:none" name="requisites-name" value="">
                    </td>
                </tr>
            </tbody>
        </table>
    </section>

    <section class="container expenditure">
        <h2>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –Ω–æ—Ä–º, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏—Ö –Ω–∞–ª–∏—á–∏–µ —Ä–∞—Å—Ö–æ–¥–Ω—ã—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –∏ –±—é–¥–∂–µ—Ç–Ω—ã—Ö –∞—Å—Å–∏–≥–Ω–æ–≤–∞–Ω–∏–π 
            –Ω–∞ —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π —Å–æ—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è 
            –∑–∞ —Å—á–µ—Ç —Å—É–±—Å–∏–¥–∏–π –æ–±–ª–∞—Å—Ç–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, —Å–æ—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –æ—Å—É—â–µ—Å—Ç–≤–∏—Ç—å –∑–∞ —Å—á–µ—Ç —Å—É–±—Å–∏–¥–∏–∏</th>
                    <th>–°—Ç—Ä–∞–Ω–∏—Ü–∞, –ø—É–Ω–∫—Ç –∏–ª–∏ –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –ø–æ —Ç–µ–∫—Å—Ç—É –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–∞–≤–æ–≤–æ–≥–æ –∞–∫—Ç–∞ –æ –±—é–¥–∂–µ—Ç–µ</th>
                    <th>–°—É–º–º–∞ –±—é–¥–∂–µ—Ç–Ω—ã—Ö –∞—Å—Å–∏–≥–Ω–æ–≤–∞–Ω–∏–π (—Ä—É–±–ª–µ–π)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div>–ú—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ ¬´–†–∞–∑–≤–∏—Ç–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, –∫—É–ª—å—Ç—É—Ä—ã, —Å–ø–æ—Ä—Ç–∞ –∏ –º–æ–ª–æ–¥–µ–∂–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ –ö–∞–º—ã—à–ª–æ–≤—Å–∫–æ–º –≥–æ—Ä–æ–¥—Å–∫–æ–º –æ–∫—Ä—É–≥–µ –¥–æ 2027 –≥–æ–¥–∞¬ª, –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ "–†–∞–∑–≤–∏—Ç–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ —Å—Ñ–µ—Ä–µ –∫—É–ª—å—Ç—É—Ä—ã –≤ –ö–∞–º—ã—à–ª–æ–≤—Å–∫–æ–º –≥–æ—Ä–æ–¥—Å–∫–æ–º –æ–∫—Ä—É–≥–µ", –û—Å–Ω–∞—â–µ–Ω–∏–µ –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è (–¥–µ—Ç—Å–∫–∏–µ —à–∫–æ–ª—ã –∏—Å–∫—É—Å—Å—Ç–≤) –º—É–∑—ã–∫–∞–ª—å–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –∏ —É—á–µ–±–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö —Å–æ—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞</div>
                        <input form="formOrder" type="text" style="display:none" name="expenditure-name" value="">
                    </td>
                    <td>
                        <div>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, 4 —Å—Ç—Ä–æ–∫–∞, 495 </div>
                        <input form="formOrder" type="text" style="display:none" name="expenditure-line" value="">
                    </td>
                    <td>
                        <div>–°—É–º–º–∞ –Ω–∞ 2023 –≥–æ–¥
    
                        5 969 000,00</div>
                        <input form="formOrder" type="text" style="display:none" name="expenditure-sum" value="">
                    </td>
                </tr>
            </tbody>
        </table>
    </section>

    <section class="container income">
        <h2>–î–æ—Ö–æ–¥—ã</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>–ö–ë–ö</th>
                    <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                    <th>–°—É–º–º–∞</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div>90620225519040000150</div>
                        <input form="formOrder" type="text" style="display:none" name="income-dkbk" value="">
                    </td>
                    <td>
                        <div>–°—É–±—Å–∏–¥–∏–∏ –±—é–¥–∂–µ—Ç–∞–º –≥–æ—Ä–æ–¥—Å–∫–∏—Ö –æ–∫—Ä—É–≥–æ–≤ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Ç—Ä–∞—Å–ª–∏ –∫—É–ª—å—Ç—É—Ä—ã</div>
                        <input form="formOrder" type="text" style="display:none" name="income-name" value="">
                    </td>
                    <td>
                        <div>–°—É–º–º–∞ –Ω–∞ 2023 –≥–æ–¥  (—Ä—É–±–ª–µ–π)
                        5 313 000,00</div>
                        <input form="formOrder" type="text" style="display:none" name="income-sum" value="">
                    </td>
                </tr>
            </tbody>
        </table>
    </section>

    <section class="container expense">
        <h2>–†–∞—Å—Ö–æ–¥—ã</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–≤–æ–¥–Ω–æ–π –±—é–¥–∂–µ—Ç–Ω–æ–π —Ä–æ—Å–ø–∏—Å–∏ (–≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–≤–æ–¥–Ω—É—é –±—é–¥–∂–µ—Ç–Ω—É—é —Ä–æ—Å–ø–∏—Å—å) –¥/–º/–≥</th>
                    <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –æ—Ä–≥–∞–Ω–∞</th>
                    <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ —Ä—É–∫–æ–≤–æ–¥–∏¬≠—Ç–µ–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –æ—Ä–≥–∞–Ω–∞</th>
                    <th>–§–∞–º–∏–ª–∏—è, –ò–º—è, –û—Ç—á–µ—Å—Ç–≤–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –æ—Ä–≥–∞–Ω–∞</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>21.12.2022 (17.01.2023) </td>
                    <td>—Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ö–∞–º—ã—à–ª–æ–≤—Å–∫–æ–≥–æ –≥–æ—Ä–æ–¥—Å–∫–æ–≥–æ –æ–∫—Ä—É–≥–∞</td>
                    <td>–ù–∞—á–∞–ª—å–Ω–∏–∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ö–∞–º—ã—à–ª–æ–≤—Å–∫–æ–≥–æ –≥–æ—Ä–æ–¥—Å–∫–æ–≥–æ –æ–∫—Ä—É–≥–∞</td>
                    <td>–°–æ–ª–¥–∞—Ç–æ–≤ –ê.–ì.</td>
                </tr>
            </tbody>
        </table>
        <table class="table">
            <thead>
                <tr>
                    <th>–ö–ë–ö</th>
                    <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                    <th>–°—É–º–º–∞</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div>9060703025A155192622</div>
                        <input form="formOrder" type="text" style="display:none" name="expense-rkbk" value="">
                    </td>
                    <td>
                        <div>–ú—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ ¬´–†–∞–∑–≤–∏—Ç–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, –∫—É–ª—å—Ç—É—Ä—ã, —Å–ø–æ—Ä—Ç–∞ –∏ –º–æ–ª–æ–¥–µ–∂–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ –ö–∞–º—ã—à–ª–æ–≤—Å–∫–æ–º –≥–æ—Ä–æ–¥—Å–∫–æ–º –æ–∫—Ä—É–≥–µ –¥–æ 2027 –≥–æ–¥–∞¬ª, –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ "–†–∞–∑–≤–∏—Ç–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ —Å—Ñ–µ—Ä–µ –∫—É–ª—å—Ç—É—Ä—ã –≤ –ö–∞–º—ã—à–ª–æ–≤—Å–∫–æ–º –≥–æ—Ä–æ–¥—Å–∫–æ–º –æ–∫—Ä—É–≥–µ", –û—Å–Ω–∞—â–µ–Ω–∏–µ –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è (–¥–µ—Ç—Å–∫–∏–µ —à–∫–æ–ª—ã –∏—Å–∫—É—Å—Å—Ç–≤) –º—É–∑—ã–∫–∞–ª—å–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –∏ —É—á–µ–±–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö —Å–æ—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞</div>
                        <input form="formOrder" type="text" style="display:none" name="expense-name" value="">
                    </td>
                    <td>
                        <div>–°—É–º–º–∞ –Ω–∞ 2023 –≥–æ–¥ (—Ä—É–±–ª–µ–π)
    
                        5 969 000,00</div>
                        <input form="formOrder" type="text" style="display:none" name="expense-sum" value="">
                    </td>
                    <button id="btn-rkbk">...–≤—ã–±—Ä–∞—Ç—å –∫–±–∫</button>
                </tr>
            </tbody>
        </table>
    </section>
    <input form="formOrder" type="submit" id="btnSave" value="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å">`
    
    modal.style.display = 'block';
    
    let tds = document.querySelectorAll('td');

    for (let i = 0; i < tds.length; i++) {
        tds[i].addEventListener('click', function func() {
            this.firstElementChild.setAttribute('contenteditable', 'true');
            this.firstElementChild.focus();
            this.firstElementChild.addEventListener('blur', function() {
                    console.log(this.innerHTML, this.nextElementSibling.value);
                    this.nextElementSibling.value = this.innerHTML;
                    console.log(this.innerHTML, this.nextElementSibling.value);
                    
                });
            this.removeEventListener('click', func)
        });
    }

    let url = 'https://budget.gov.ru/epbs/registry/7710568760-BUDGETCLASCOSTSMO/data?pageSize=1000&filterppocode=65741000'

    let btnRkbk = document.querySelector('#btn-rkbk');
    btnRkbk.addEventListener('click', () => {
        fetch(url)
            .then(response => response.json())
            .then(result => {console.log(result.data); createModalWindow(result.data)})
    })

    function createModalWindow (data) {
        let modalWindow = document.createElement('div');
        modalWindow.classList.add('modal');
        let tdRkbk = document.querySelector('#td-rkbk')
        
        for (let item of data) {
            let div = document.createElement('div');
            div.innerHTML = item.grbscode + ' ' + item.rzpr + ' ' + item.kcsr + ' ' + item.kvr;
            div.addEventListener('click', (e) => {
                console.log(e)
                tdRkbk.innerHTML = e.target.innerHTML;
                modalWindow.remove();
                //modalWindow.style.display = "none"
            })
            modalWindow.append(div);
        }
       
        document.body.append(modalWindow);
    }

    //////////////////////////////////////////////

    // let btnSave = document.querySelector('#btnSave');
    // btnSave.addEventListener('click', () => {
    //     //let tableReq = document.querySelector('.requisites table');
    //     const nodeList = document.querySelectorAll(".requisites table tbody tr");
    //     nodeList.forEach((node) => {
    //         const order = {};
    //         order.requisites = {};
    //         order.requisites.number = node.cells[0].innerHTML;
    //         order.requisites.date = node.cells[1].innerHTML;
    //         order.requisites.type = node.cells[2].innerHTML;
    //         order.requisites.name = node.cells[3].innerHTML;
    //         console.log(order);
    //     })
    //     //const rowsTableReq = Array.from(nodeList);
    //     //console.log(rowsTableReq); 
    // })

/////////////////////////////////////////////////////////

    formOrder.addEventListener('submit', (e) => {
        e.preventDefault();
        let formData = new FormData(formOrder);
        for(let [name, value] of formData) {
            console.log(`${name} = ${value}`); 
        }
    })

}